"use strict";(self["webpackChunkapi_test_platform"]=self["webpackChunkapi_test_platform"]||[]).push([[782],{224:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});a(4114);var s=a(6768),l=a(4232);const n={class:"list_box"},i={style:{color:"#009A71","font-weight":"bold","font-size":"14px"}},o={style:{"font-weight":"bold","font-size":"14px"}},c={ref:"chartTable",class:"char_box1"},d={key:0},r={key:1},u={key:0},p={key:1},h={key:0},f={key:1},k={key:0},_={class:"select_content"},m={style:{margin:"10px","text-align":"center"}};function b(e,t,a,b,g,y){const w=(0,s.g2)("el-button"),F=(0,s.g2)("CollectionTag"),v=(0,s.g2)("el-icon"),C=(0,s.g2)("el-menu-item"),P=(0,s.g2)("el-menu"),x=(0,s.g2)("el-col"),I=(0,s.g2)("el-divider"),L=(0,s.g2)("el-input"),$=(0,s.g2)("el-row"),S=(0,s.g2)("el-table-column"),T=(0,s.g2)("el-table"),z=(0,s.g2)("el-tag"),W=(0,s.g2)("el-tooltip"),X=(0,s.g2)("el-drawer");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)($,{gutter:10,style:{height:"calc(100vh - 68px)"}},{default:(0,s.k6)((()=>[(0,s.bF)(x,{span:4},{default:(0,s.k6)((()=>[(0,s.Lk)("div",n,[t[6]||(t[6]=(0,s.Lk)("div",{class:"title"},"测试计划",-1)),(0,s.bF)(w,{onClick:y.addPlan,icon:"Plus",plain:"",type:"success",style:{width:"100%"}},{default:(0,s.k6)((()=>t[5]||(t[5]=[(0,s.eW)("添加测试计划")]))),_:1,__:[5]},8,["onClick"]),(0,s.bF)(P,{"default-active":g.active,class:"el-menu-vertical-demo","active-text-color":"#00aa7f","text-color":"#000000",style:{background:"none",border:"none"}},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(g.planList,(e=>((0,s.uX)(),(0,s.Wv)(C,{onClick:t=>y.getPlanData(e),index:e.id.toString(),style:{height:"35px","line-height":"35px"}},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)(F)])),_:1}),(0,s.Lk)("span",null,(0,l.v_)(e.name),1)])),_:2},1032,["onClick","index"])))),256))])),_:1},8,["default-active"])])])),_:1}),g.planInfo?((0,s.uX)(),(0,s.Wv)(x,{key:0,span:10},{default:(0,s.k6)((()=>[(0,s.bF)(I,{"content-position":"left"},{default:(0,s.k6)((()=>t[7]||(t[7]=[(0,s.Lk)("b",null,"基本信息",-1)]))),_:1,__:[7]}),(0,s.bF)($,{gutter:5,style:{"margin-bottom":"20px"}},{default:(0,s.k6)((()=>[(0,s.bF)(x,{span:16},{default:(0,s.k6)((()=>[(0,s.bF)(L,{modelValue:g.planInfo.name,"onUpdate:modelValue":t[0]||(t[0]=e=>g.planInfo.name=e),size:"small"},{prepend:(0,s.k6)((()=>t[8]||(t[8]=[(0,s.eW)(" 场景名称 ")]))),append:(0,s.k6)((()=>[(0,s.bF)(w,{onClick:y.savePlan,plain:"",icon:"CircleCheck",size:"small",type:"success"},{default:(0,s.k6)((()=>t[9]||(t[9]=[(0,s.eW)("保存")]))),_:1,__:[9]},8,["onClick"])])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(x,{span:8,style:{"text-align":"right"}},{default:(0,s.k6)((()=>[(0,s.bF)(w,{onClick:y.runPlan,plain:"",size:"small",type:"success",icon:"Promotion"},{default:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.eW)("运行")]))),_:1,__:[10]},8,["onClick"]),(0,s.bF)(w,{onClick:y.delPlan,plain:"",icon:"Delete",size:"small",type:"danger"},{default:(0,s.k6)((()=>t[11]||(t[11]=[(0,s.eW)("删除")]))),_:1,__:[11]},8,["onClick"])])),_:1})])),_:1}),(0,s.bF)(I,{"content-position":"left"},{default:(0,s.k6)((()=>t[12]||(t[12]=[(0,s.Lk)("b",null,"测试场景",-1)]))),_:1,__:[12]}),(0,s.bF)(w,{onClick:t[1]||(t[1]=e=>g.drawer=!0),plain:"",icon:"Plus",size:"small",type:"success"},{default:(0,s.k6)((()=>t[13]||(t[13]=[(0,s.eW)("添加")]))),_:1,__:[13]}),(0,s.bF)(T,{data:g.scenes,"row-key":"id",style:{width:"100%","margin-bottom":"10px"},"show-header":!1,height:"calc(100vh - 235px)"},{default:(0,s.k6)((()=>[(0,s.bF)(S,null,{default:(0,s.k6)((e=>[(0,s.Lk)("span",i,(0,l.v_)("测试场景"+(e.$index+1)+": "),1),(0,s.Lk)("span",o,(0,l.v_)(e.row.name),1)])),_:1}),(0,s.bF)(S,{width:"100px"},{default:(0,s.k6)((e=>[(0,s.bF)(w,{onClick:t=>y.delPlanInScene(e.$index),plain:"",size:"small",type:"danger",icon:"Delete"},{default:(0,s.k6)((()=>t[14]||(t[14]=[(0,s.eW)("删除 ")]))),_:2,__:[14]},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1})):(0,s.Q3)("",!0),(0,s.bF)(x,{span:10},{default:(0,s.k6)((()=>[(0,s.bF)(I,{"content-position":"left"},{default:(0,s.k6)((()=>t[15]||(t[15]=[(0,s.Lk)("b",null,"通过率趋势图",-1)]))),_:1,__:[15]}),(0,s.Lk)("div",c,null,512),(0,s.bF)(I,{"content-position":"left"},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.Lk)("b",null,"执行记录",-1)]))),_:1,__:[16]}),(0,s.bF)(T,{data:g.records,class:"table-style",size:"small",height:"calc(100vh - 380px)"},{default:(0,s.k6)((()=>[(0,s.bF)(S,{prop:"created_time",label:"执行时间","min-width":"140"}),(0,s.bF)(S,{prop:"env_name",label:"测试环境","min-width":"110"}),(0,s.bF)(S,{prop:"all",label:"总用例","min-width":"50"},{default:(0,s.k6)((e=>["finished"===e.row.status?((0,s.uX)(),(0,s.CE)("span",d,(0,l.v_)(e.row.all),1)):((0,s.uX)(),(0,s.CE)("span",r,"执行中"))])),_:1}),(0,s.bF)(S,{label:"通过数","min-width":"50"},{default:(0,s.k6)((e=>["finished"===e.row.status?((0,s.uX)(),(0,s.CE)("span",u,(0,l.v_)(e.row.success),1)):((0,s.uX)(),(0,s.CE)("span",p,"执行中"))])),_:1}),(0,s.bF)(S,{label:"通过率","min-width":"80"},{default:(0,s.k6)((e=>["finished"===e.row.status?((0,s.uX)(),(0,s.CE)("span",h,(0,l.v_)(e.row.pass_rate+"%"),1)):((0,s.uX)(),(0,s.CE)("span",f,"执行中"))])),_:1}),(0,s.bF)(S,{label:"测试报告",width:"100"},{default:(0,s.k6)((a=>["执行中"===a.row.status?((0,s.uX)(),(0,s.CE)("span",k,[(0,s.bF)(z,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.row.status)+"...",1)])),_:2},1024)])):((0,s.uX)(),(0,s.Wv)(w,{key:1,type:"success",icon:"View",plain:"",size:"small",onClick:t=>e.$router.push({name:"report",params:{id:a.row.id}})},{default:(0,s.k6)((()=>t[17]||(t[17]=[(0,s.eW)("报告 ")]))),_:2,__:[17]},1032,["onClick"]))])),_:1})])),_:1},8,["data"])])),_:1})])),_:1}),(0,s.bF)(X,{modelValue:g.drawer,"onUpdate:modelValue":t[4]||(t[4]=e=>g.drawer=e),direction:"rtl",size:"20%","show-close":!1},{header:(0,s.k6)((()=>t[18]||(t[18]=[(0,s.Lk)("b",{style:{color:"#000000"}},"添加测试流程",-1)]))),default:(0,s.k6)((()=>[(0,s.Lk)("div",_,[(0,s.bF)(T,{ref:"addRef",onSelectionChange:y.selectTable,size:"small",data:y.Scenes2,"tooltip-effect":"dark",style:{width:"100%"}},{default:(0,s.k6)((()=>[(0,s.bF)(S,{type:"selection","min-width":"40"}),(0,s.bF)(S,{prop:"name",label:"全选","min-width":"120"})])),_:1},8,["onSelectionChange","data"])]),(0,s.Lk)("div",m,[(0,s.bF)(W,{class:"item",effect:"dark",content:"添加选中测试流程到任务中",placement:"top-start"},{default:(0,s.k6)((()=>[(0,s.bF)(w,{onClick:y.addSceneToPlan,plain:"",type:"success",size:"small"},{default:(0,s.k6)((()=>t[19]||(t[19]=[(0,s.eW)("确认添加")]))),_:1,__:[19]},8,["onClick"])])),_:1}),(0,s.bF)(W,{class:"item",effect:"dark",content:"清除选中选项",placement:"top-start"},{default:(0,s.k6)((()=>[(0,s.bF)(w,{plain:"",type:"warning",size:"small",onClick:t[2]||(t[2]=t=>e.$refs.addRef.clearSelection())},{default:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.eW)("清除选中")]))),_:1,__:[20]})])),_:1}),(0,s.bF)(W,{class:"item",effect:"dark",content:"关闭当前窗口",placement:"top-start"},{default:(0,s.k6)((()=>[(0,s.bF)(w,{plain:"",type:"danger",size:"small",onClick:t[3]||(t[3]=e=>g.drawer=!1)},{default:(0,s.k6)((()=>t[21]||(t[21]=[(0,s.eW)("关闭窗口")]))),_:1,__:[21]})])),_:1})])])),_:1},8,["modelValue"])],64)}a(8111),a(2489),a(116),a(7588);var g=a(782),y=a(3851),w=a(2933),F=a(1219),v={data(){return{active:"1",planList:[],planInfo:null,scenes:[],records:[],drawer:!1,addSceneList:[]}},computed:{...(0,g.aH)(["pro","envId","testScenes"]),chartData:function(){let e=[],t=[];for(let a of this.records)e.push(this.$date.rTime(a.create_time)),t.push(parseFloat(a.pass_rate).toFixed(2));return{label:e.reverse(),value:t.reverse()}},Scenes2:function(){let e=this.testScenes.filter(((e,t)=>!this.scenes.find((t=>t.id==e.id))));return e}},methods:{async getAllPlan(){const e=await this.$api.getTestPlan(this.pro.id);200===e.status&&(this.planList=e.data,this.planList.length>0&&null==this.planInfo&&(this.active=this.planList[0].id.toString(),this.getPlanData(this.planList[0])))},async getPlanData(e){this.planInfo={...e};const t=await this.$api.getTestScene({testplan:e.id});200===t.status&&(this.scenes=t.data),this.getAllRecord()},async getAllRecord(){const e=await this.$api.getTestRecord({plan:this.planInfo.id});200==e.status&&(this.records=e.data)},async addPlan(){const e={project:this.pro.id,name:"New Plan"},t=await this.$api.createTestPlan(e);201===t.status&&(this.$message({type:"success",message:"添加成功",duration:1e3}),this.getAllPlan())},async savePlan(){const e=await this.$api.updateTestPlan(this.planInfo.id,this.planInfo);200===e.status&&(this.$message({type:"success",message:"保存成功",duration:1e3}),this.getAllPlan())},async runPlan(){if(this.envId){const e={env:this.envId,plan:this.planInfo.id};this.$message({type:"success",message:"开始运行!",duration:1e3});const t=await this.$api.runTest(e);200===t.status&&((0,y.df)({title:"提示",message:t.data.status,duration:1e3}),this.getAllRecord())}else this.$message({type:"warning",message:"当前未选中测试环境!",duration:1e3})},delPlan(){w.s.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await this.$api.delTestPlan(this.planInfo.id);204===e.status&&((0,F.nk)({type:"success",message:"删除成功",duration:1e3}),this.getAllPlan())})).catch((()=>{(0,F.nk)({type:"info",message:"取消删除",duration:1e3})}))},selectTable(e){this.addSceneList=[],e.forEach((e=>{this.addSceneList.push(e.id)}))},async addSceneToPlan(){let e={...this.planInfo};e.scenes.push(...this.addSceneList);const t=await this.$api.updateTestPlan(e.id,e);200===t.status&&(this.$message({type:"success",message:"添加成功",duration:1e3}),this.planInfo=t.data,this.getPlanData(this.planInfo)),this.$refs.addRef.clearSelection()},async delPlanInScene(e){let t={...this.planInfo};t.scenes.splice(e,1);const a=await this.$api.updateTestPlan(t.id,t);200===a.status&&(this.$message({type:"success",message:"删除成功",duration:1e3}),this.planInfo=a.data,this.getPlanData(this.planInfo))}},created(){this.getAllPlan()},watch:{records(e){e&&this.$chart.chart3(this.$refs.chartTable,this.chartData.value,this.chartData.label)}}},C=a(1241);const P=(0,C.A)(v,[["render",b],["__scopeId","data-v-a32bb25a"]]);var x=P}}]);
//# sourceMappingURL=group-5.e5425408.js.map